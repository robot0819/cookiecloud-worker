
# ğŸª CookieCloud Worker D1 è¶…ç®€å•éƒ¨ç½²æ•™ç¨‹

æ¬¢è¿ä½¿ç”¨ CookieCloud Worker D1ï¼è¿™æ˜¯ä¸€ä¸ªåŸºäº Cloudflare Worker å’Œ D1 æ•°æ®åº“çš„ CookieCloud åç«¯ï¼Œå¸®ä½ è½»æ¾æå®š Cookie äº‘åŒæ­¥ã€‚

---

## ğŸš€ ä¸€é”®éƒ¨ç½²ï¼Œé›¶åŸºç¡€ä¹Ÿèƒ½ä¸Šæ‰‹ï¼

åªéœ€è¦ç‚¹ä¸‹é¢è¿™ä¸ªæŒ‰é’®ï¼Œå°±èƒ½æŠŠé¡¹ç›®ä¸€é”®éƒ¨ç½²åˆ°ä½ è‡ªå·±çš„ Cloudflare è´¦å·é‡Œï¼š

[![ä¸€é”®éƒ¨ç½²åˆ° Cloudflare Workers](https://deploy.workers.cloudflare.com/button)](https://deploy.workers.cloudflare.com/?url=https://github.com/qaz741wsd856/CookieCloud-Worker-D1)

éƒ¨ç½²å®Œæˆåï¼Œä½ ä¼šæ‹¿åˆ°ä¸€ä¸ªç±»ä¼¼ `https://<...>.workers.dev` çš„ç½‘å€ã€‚æŠŠå®ƒå¡«åˆ° CookieCloud æ’ä»¶çš„â€œæœåŠ¡å™¨åœ°å€â€é‡Œå°±èƒ½ç”¨äº†ï¼

---

## âš ï¸ ä½¿ç”¨å‰å¿…çœ‹å°è´´å£«

Cloudflare Worker å…è´¹ç‰ˆæœ‰ä¸€äº›é™åˆ¶ï¼Œç®€å•è¯´å°±æ˜¯ï¼š

1. **å•è¡Œæ•°æ®ä¸èƒ½è¶…è¿‡ 2MB**ï¼ˆD1 é™åˆ¶ï¼‰ç›®å‰æˆ‘å·²ç»é æ•°æ®åˆ†å—ç»•è¿‡äº†
2. **å†…å­˜æœ€å¤š 128MB**ï¼ˆå¾ˆå®¹æ˜“è¶…ï¼Œå»ºè®®å¤‡ä»½åˆ«å¤ªå¤§ï¼‰
3. **æ¯æ¬¡è¯·æ±‚æœ€å¤š 50 æ¬¡æ•°æ®åº“æ“ä½œ**
4. **æ¯æ¬¡è¯·æ±‚çš„ CPU æ—¶é—´ä¸è¶…è¿‡10ms**ï¼ˆä½†å®é™…ç”¨çš„æ—¶å€™å¯ä»¥è¶…ä¸€ç‚¹ï¼Œåˆ«å¤ªè¿‡åˆ†ï¼‰

ä¸Šä¼ /å¤‡ä»½æ•°æ®æ—¶ä¼šå ç”¨ä¸¤å€å†…å­˜ï¼Œæ‰€ä»¥ç†è®ºä¸Šå¤‡ä»½ä¸èƒ½è¶…è¿‡ 64MBï¼Œå®é™…ç”¨èµ·æ¥å»ºè®®æ§åˆ¶åœ¨ 32MB ä»¥ä¸‹ã€‚

ä»æˆ‘æµ‹è¯•çš„ç»“æœæ¥çœ‹ï¼Œåœ¨å¤‡ä»½ 3MB çš„æ•°æ®æ—¶ï¼Œå…‰æ˜¯è§£æçš„æ—¶é—´å°±å·²ç»æ¥è¿‘ 10ms äº†ï¼Œå»ºè®®åªå¤‡ä»½ä½ éœ€è¦çš„åŸŸåæ•°æ®ï¼ŒLocal Storage æ²¡å¿…è¦å°±åˆ«å¤‡ä»½ã€‚

å¦‚æœå†…å­˜è¶…äº†ï¼ŒWorker ä¼šæŠ¥ `exceeded memory limit` é”™è¯¯ï¼›å¦‚æœ CPU æ—¶é—´è¶…äº†ï¼ŒWorker ä¼šæŠ¥ `exceeded CPU time limit`ã€‚

---

## ğŸ› ï¸ è¿›é˜¶ç©æ³•ï¼šè‡ªå®šä¹‰åŸŸå & è·¯å¾„

### 1. ç”¨è‡ªå·±çš„åŸŸåè®¿é—®ï¼ˆæ¯”å¦‚ `cookie-api.yourdomain.com`ï¼‰

**å‰æï¼šä½ å¾—æœ‰è‡ªå·±çš„åŸŸåï¼Œå¹¶ä¸”å·²ç»åŠ åˆ° Cloudflare é‡Œç®¡ç†ã€‚**

#### æ­¥éª¤ä¸€ï¼šåŠ  DNS è®°å½•

1. ç™»å½• Cloudflare ä»ªè¡¨ç›˜ï¼Œé€‰ä½ çš„åŸŸåï¼ˆæ¯”å¦‚ `yourdomain.com`ï¼‰
2. å·¦è¾¹èœå•ç‚¹ **DNS** -> **è®°å½• (Records)**
3. ç‚¹ **æ·»åŠ è®°å½• (Add record)**ï¼š
    - ç±»å‹é€‰ `AAAA`
    - åç§°å¡«ä½ æƒ³è¦çš„å­åŸŸåï¼ˆæ¯”å¦‚ `cookie-api`ï¼‰
    - IPv6 åœ°å€å¡« `100::`
    - å¯ç”¨å°é»„äº‘ï¼Œä»£ç†çŠ¶æ€ä¸€å®šè¦æ©™è‰²ï¼ˆProxiedï¼‰ï¼
    - TTL é»˜è®¤è‡ªåŠ¨
4. ç‚¹ **ä¿å­˜ (Save)**

#### æ­¥éª¤äºŒï¼šæŠŠæµé‡è·¯ç”±åˆ° Worker

1. å·¦è¾¹èœå•ç‚¹ **Workers & Pages**
2. æ‰¾åˆ°ä½ åˆšéƒ¨ç½²çš„ Workerï¼ˆæ¯”å¦‚ `cookiecloud-worker`ï¼‰
3. ç‚¹è¿›å»ï¼Œåˆ‡åˆ° **è®¾ç½® (settings)**
4. æ‰¾åˆ° **åŸŸå’Œè·¯ç”± (Domains & Routes)**ï¼Œç‚¹ **æ·»åŠ  (Add)**ï¼Œç„¶åé€‰`è·¯ç”± (Route)`
5. è·¯ç”±å¡«å®Œæ•´åŸŸååŠ é€šé…ç¬¦ï¼Œæ¯”å¦‚ `cookie-api.yourdomain.com/*`ï¼ˆæœ€åçš„ `/*` åˆ«æ¼äº†ï¼ï¼‰
6. åŒºåŸŸé€‰ä½ çš„ä¸»åŸŸå
7. ç‚¹ **æ·»åŠ è·¯ç”± (Add Route)**

ç­‰å‡ åç§’åˆ°ä¸€åˆ†é’Ÿï¼ŒDNS å’Œè·¯ç”±å°±ç”Ÿæ•ˆå•¦ï¼ç°åœ¨ä½ å¯ä»¥ç”¨è‡ªå·±çš„åŸŸåè®¿é—® CookieCloud æœåŠ¡äº†ã€‚

---

### 2. è®¾ç½®è‡ªå®šä¹‰ API è·¯å¾„ï¼ˆè®©æ¥å£æ›´å®‰å…¨ï¼‰

ä½ å¯ä»¥ç»™ API è®¾ç½®ä¸€ä¸ªä¸å®¹æ˜“çŒœåˆ°çš„è·¯å¾„ï¼ˆæ¯”å¦‚ `my-secret-path-123`ï¼‰ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½è¦å¸¦è¿™ä¸ªå‰ç¼€ã€‚

**æ€ä¹ˆè®¾ç½®ï¼š**

1. ç™»å½• Cloudflare ä»ªè¡¨ç›˜ï¼Œç‚¹ **Workers & Pages**
2. æ‰¾åˆ°ä½ çš„ Workerï¼Œç‚¹è¿›å»ï¼Œåˆ‡åˆ° **è®¾ç½® (Settings)** -> **å˜é‡ (Variables)**
3. æ‰¾åˆ° **ç¯å¢ƒå˜é‡ (Environment Variables)**ï¼Œç‚¹ **æ·»åŠ å˜é‡ (Add variable)**
4. å˜é‡åå¡« `API_ROOT`ï¼Œå€¼å¡«ä½ æƒ³è¦çš„è·¯å¾„ï¼ˆæ¯”å¦‚ `my-secret-path-123`ï¼Œä¸ç”¨åŠ æ–œæ ï¼‰
5. ç‚¹ **ä¿å­˜å¹¶éƒ¨ç½² (Save and deploy)**

è®¾ç½®å¥½åï¼Œä½ åœ¨ CookieCloud æ’ä»¶çš„â€œæœåŠ¡å™¨åœ°å€â€å°±è¦å¡«æˆ `https://<...>.workers.dev/my-secret-path-123` äº†ã€‚

---

### 3. è‡ªå®šä¹‰åˆ†å—å¤§å°ï¼ˆé˜²æ­¢å•è¡Œè¶…é™ï¼‰

å¦‚æœä¹‹å D1 çš„å•è¡Œé™åˆ¶æ”¹äº†ï¼Œå¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡ `CHUNK_SIZE` æ”¹åˆ†å—å¤§å°ï¼ˆé»˜è®¤ 1900000 å­—èŠ‚ï¼‰ï¼Œè®¾ç½®æ–¹æ³•å’Œä¸Šé¢ä¸€æ ·ã€‚

---

## ğŸ’¬ æœ‰é—®é¢˜ï¼Ÿ

æ¬¢è¿æ Issue æˆ–åœ¨ GitHub è®¨è®ºåŒºç•™è¨€ï¼